var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&a(e,n,t[n]);return e},r=(e,o)=>t(e,n(o)),c=(e,t,n)=>new Promise(((o,l)=>{var i=e=>{try{s(n.next(e))}catch(t){l(t)}},a=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));import{_ as u}from"./Icon-DYE_U4AS.js";import{gs as d,a6 as p,d as f,C as g,s as m,i as v,H as h,F as b,aa as C,k,B as y,a9 as x,ao as S,gF as P,cH as w,y as E,A as _,x as R,G as N,fY as z,r as O,a5 as T,cG as j,eU as D,am as L,V as I,p as F,ay as $,b3 as B,bk as V,X as A,o as U,e as M,w as H,a as q,h as W,q as K,bx as Y,b as G,E as J,gk as Q,gN as X,gL as Z,gJ as ee,L as te,et as ne,Y as oe,gM as le,a0 as ie,c as ae,S as se,T as re,t as ce,f as ue,U as de,h7 as pe,D as fe,ag as ge,P as me,M as ve,O as he,Q as be,R as Ce,a4 as ke,$ as ye,dR as xe,dP as Se,e8 as Pe}from"./index-C6F7-JtS.js";import{d as we,C as Ee}from"./vuedraggable-CIX9DEG0.js";import{c as _e,p as Re,_ as Ne}from"./Tooltip-CPoKw1Lj.js";import{N as ze}from"./Icon-Besm54VG.js";import{_ as Oe,a as Te}from"./Checkbox-DY9r01Qv.js";import{_ as je}from"./Space-nLn5ELHN.js";import{_ as De}from"./Divider-C2yuMtyF.js";import{u as Le,_ as Ie}from"./useWindowSizeFn-j4qeEG2y.js";import{_ as Fe}from"./Input-DqCdjJu0.js";import{N as $e}from"./InputNumber-BGGzQzEn.js";import{_ as Be}from"./Select-DA-oj4aE.js";import{_ as Ve}from"./Switch-5e_v6W0i.js";import{N as Ae,a as Ue}from"./DatePicker-w1EpL8-p.js";import{p as Me}from"./propTypes-BrA6lfYr.js";import{i as He}from"./isEqual-BUASm4lt.js";import{c as qe,g as We}from"./componentSetting-C8-BnnRr.js";import{d as Ke,_ as Ye}from"./DataTable-D-trrUIx.js";import{N as Ge}from"./Dropdown-CpWL-kUI.js";import{u as Je}from"./use-locale-ByhSuOII.js";var Qe=365.2425;function Xe(e){var t=e.years,n=e.months,o=e.weeks,l=e.days,i=e.hours,a=e.minutes,s=e.seconds;d(1,arguments);var r=0;t&&(r+=t*Qe),n&&(r+=30.436875*n),o&&(r+=7*o),l&&(r+=l);var c=24*r*60*60;return i&&(c+=60*i*60),a&&(c+=60*a),s&&(c+=s),Math.round(1e3*c)}const Ze=p("n-popconfirm"),et={positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0}},tt=w(et),nt=f({name:"NPopconfirmPanel",props:et,setup(e){const{localeRef:t}=Je("Popconfirm"),{inlineThemeDisabled:n}=g(),{mergedClsPrefixRef:o,mergedThemeRef:l,props:i}=m(Ze),a=v((()=>{const{common:{cubicBezierEaseInOut:e},self:{fontSize:t,iconSize:n,iconColor:o}}=l.value;return{"--n-bezier":e,"--n-font-size":t,"--n-icon-size":n,"--n-icon-color":o}})),s=n?h("popconfirm-panel",void 0,a,i):void 0;return Object.assign(Object.assign({},Je("Popconfirm")),{mergedClsPrefix:o,cssVars:n?void 0:a,localizedPositiveText:v((()=>e.positiveText||t.value.positiveText)),localizedNegativeText:v((()=>e.negativeText||t.value.negativeText)),positiveButtonProps:b(i,"positiveButtonProps"),negativeButtonProps:b(i,"negativeButtonProps"),handlePositiveClick(t){e.onPositiveClick(t)},handleNegativeClick(t){e.onNegativeClick(t)},themeClass:null==s?void 0:s.themeClass,onRender:null==s?void 0:s.onRender})},render(){var e;const{mergedClsPrefix:t,showIcon:n,$slots:o}=this,l=C(o.action,(()=>null===this.negativeText&&null===this.positiveText?[]:[null!==this.negativeText&&k(y,Object.assign({size:"small",onClick:this.handleNegativeClick},this.negativeButtonProps),{default:()=>this.localizedNegativeText}),null!==this.positiveText&&k(y,Object.assign({size:"small",type:"primary",onClick:this.handlePositiveClick},this.positiveButtonProps),{default:()=>this.localizedPositiveText})]));return null===(e=this.onRender)||void 0===e||e.call(this),k("div",{class:[`${t}-popconfirm__panel`,this.themeClass],style:this.cssVars},x(o.default,(e=>n||e?k("div",{class:`${t}-popconfirm__body`},n?k("div",{class:`${t}-popconfirm__icon`},C(o.icon,(()=>[k(S,{clsPrefix:t},{default:()=>k(P,null)})]))):null,e):null)),l?k("div",{class:[`${t}-popconfirm__action`]},l):null)}}),ot=E("popconfirm",[_("body","\n font-size: var(--n-font-size);\n display: flex;\n align-items: center;\n flex-wrap: nowrap;\n position: relative;\n ",[_("icon","\n display: flex;\n font-size: var(--n-icon-size);\n color: var(--n-icon-color);\n transition: color .3s var(--n-bezier);\n margin: 0 8px 0 0;\n ")]),_("action","\n display: flex;\n justify-content: flex-end;\n ",[R("&:not(:first-child)","margin-top: 8px"),E("button",[R("&:not(:last-child)","margin-right: 8px;")])])]),lt=f({name:"Popconfirm",props:Object.assign(Object.assign(Object.assign({},N.props),Re),{positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},trigger:{type:String,default:"click"},positiveButtonProps:Object,negativeButtonProps:Object,onPositiveClick:Function,onNegativeClick:Function}),__popover__:!0,setup(e){const{mergedClsPrefixRef:t}=g(),n=N("Popconfirm","-popconfirm",ot,z,e,t),o=O(null);T(Ze,{mergedThemeRef:n,mergedClsPrefixRef:t,props:e});return{setShow(e){var t;null===(t=o.value)||void 0===t||t.setShow(e)},syncPosition(){var e;null===(e=o.value)||void 0===e||e.syncPosition()},mergedTheme:n,popoverInstRef:o,handlePositiveClick:function(t){var n;if(!(null===(n=o.value)||void 0===n?void 0:n.getMergedShow()))return;const{onPositiveClick:l,"onUpdate:show":i}=e;Promise.resolve(!l||l(t)).then((e=>{var t;!1!==e&&(null===(t=o.value)||void 0===t||t.setShow(!1),i&&L(i,!1))}))},handleNegativeClick:function(t){var n;if(!(null===(n=o.value)||void 0===n?void 0:n.getMergedShow()))return;const{onNegativeClick:l,"onUpdate:show":i}=e;Promise.resolve(!l||l(t)).then((e=>{var t;!1!==e&&(null===(t=o.value)||void 0===t||t.setShow(!1),i&&L(i,!1))}))}}},render(){const{$slots:e,$props:t,mergedTheme:n}=this;return k(_e,D(t,tt,{theme:n.peers.Popover,themeOverrides:n.peerOverrides.Popover,internalExtraClass:["popconfirm"],ref:"popoverInstRef"}),{trigger:e.activator||e.trigger,default:()=>{const n=j(t,tt);return k(nt,Object.assign(Object.assign({},n),{onPositiveClick:this.handlePositiveClick,onNegativeClick:this.handleNegativeClick}),e)}})}}),it=Symbol("s-table");function at(){return m(it)}const st=f({name:"ColumnSetting",components:{Draggable:we},setup(){const e=at(),t=O([]),n=O([]),o=F({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),l=v((()=>o.selection));function i(t){e.setColumns(t)}function a(){let t=[];return e.getColumns().forEach((e=>{t.push(s({},e))})),t}return $((()=>{e.getColumns().length&&function(){const e=a(),l=e.map((e=>e.key));o.checkList=l,o.defaultCheckList=l;const i=e.filter((e=>"action"!=e.key&&"操作"!=e.title));t.value.length||(t.value=B(i),n.value=B(i))}()})),r(s({},V(o)),{columnsList:t,onChange:function(e){o.selection&&e.unshift("selection"),i(e)},onCheckAll:function(t){let n=e.getCacheColumns(!0);t?(i(n),o.checkList=n):(i([]),o.checkList=[])},onSelection:function(t){let n=e.getCacheColumns();t?(n.unshift({type:"selection",key:"selection"}),i(n)):(n.splice(0,1),i(n))},resetColumns:function(){o.checkList=[...o.defaultCheckList],o.checkAll=!0;let n=e.getCacheColumns().map((e=>r(s({},e),{fixed:void 0})));i(n),t.value=n},fixedColumn:function(n,o){let l=a();const s=n.fixed===o?void 0:o;let r=l.findIndex((e=>e.key===n.key));-1!==r&&(l[r].fixed=s),e.setCacheColumnsField(n.key,{fixed:s}),t.value[r].fixed=s,i(l)},draggableEnd:function(){const e=Y(G(t));t.value=e,i(e)},getSelection:l})}}),rt={class:"cursor-pointer table-toolbar-right-icon"},ct={class:"table-toolbar-inner-popover-title"},ut={class:"table-toolbar-inner"},dt={class:"table-toolbar-inner-checkbox"},pt={class:"drag-icon"},ft={class:"fixed-item"},gt=q("span",null,"固定到左侧",-1),mt=q("span",null,"固定到右侧",-1),vt=q("span",null,"列设置",-1);const ht=I(st,[["render",function(e,t,n,o,l,i){const a=u,s=ze,r=Oe,c=y,d=je,p=Ne,f=De,g=A("Draggable"),m=Te,v=_e;return U(),M(p,{trigger:"hover"},{trigger:H((()=>[q("div",rt,[W(v,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:H((()=>[W(s,{size:"18"},{default:H((()=>[W(a,{icon:"ant-design:setting-outlined"})])),_:1})])),header:H((()=>[q("div",ct,[W(d,null,{default:H((()=>[W(r,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=t=>e.checkAll=t),e.onCheckAll]},{default:H((()=>[K("列展示")])),_:1},8,["checked","onUpdate:checked"]),W(r,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=t=>e.selection=t),e.onSelection]},{default:H((()=>[K("勾选列")])),_:1},8,["checked","onUpdate:checked"]),W(c,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:H((()=>[K("重置")])),_:1},8,["onClick"])])),_:1})])])),default:H((()=>[q("div",ut,[W(m,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=t=>e.checkList=t),e.onChange]},{default:H((()=>[W(g,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:H((({element:t})=>[q("div",dt,[q("span",pt,[W(s,{size:"18"},{default:H((()=>[W(a,{icon:"ant-design:drag-outlined"})])),_:1})]),W(r,{value:t.key,label:t.title},null,8,["value","label"]),q("div",ft,[W(p,{trigger:"hover",placement:"bottom"},{trigger:H((()=>[W(s,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:H((()=>[W(a,{icon:"ant-design:vertical-right-outlined"})])),_:2},1032,["color","onClick"])])),default:H((()=>[gt])),_:2},1024),W(f,{vertical:""}),W(p,{trigger:"hover",placement:"bottom"},{trigger:H((()=>[W(s,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:H((()=>[W(a,{icon:"ant-design:vertical-left-outlined"})])),_:2},1032,["color","onClick"])])),default:H((()=>[mt])),_:2},1024)])])])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:H((()=>[vt])),_:1})}]]);var bt=(e=>(e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value",e))(bt||{});const Ct=new Map;Ct.set("NInput",Fe),Ct.set("NInputNumber",$e),Ct.set("NSelect",Be),Ct.set("NSwitch",Ve),Ct.set("NCheckbox",Oe),Ct.set("NDatePicker",Ae),Ct.set("NTimePicker",Ue);function kt(e){return"NInput"===e?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}const yt=f({name:"EditableCell",components:{CellComponent:({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:l})=>{const i=Ct.get(e),a=k(i,l);return t?k(_e,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>a,default:()=>k("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):a}},directives:{clickOutside:Ee},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:Me.number},setup(e){const t=at(),n=O(!1),o=O(),l=O(!1),i=O(""),a=O([]),u=O(e.value),d=O(e.value),p=v((()=>{var t;return(null==(t=e.column)?void 0:t.editComponent)||"NInput"})),f=v((()=>{var t;return null==(t=e.column)?void 0:t.editRule})),g=v((()=>G(i)&&G(l))),m=v((()=>{const e=G(p);return["NCheckbox","NRadio"].includes(e)})),h=v((()=>{var t,n,o,l;const i=null!=(n=null==(t=e.column)?void 0:t.editComponentProps)?n:{},a=null!=(l=null==(o=e.column)?void 0:o.editComponent)?l:null,c=G(p),d=G(m),f=d?"checked":"value",g=G(u);let v=d?Q(g)&&X(g)?g:!!g:g;Z(v)&&"NDatePicker"===c?v=Xe(v):ee(v)&&"NDatePicker"===c&&(v=v.map((e=>Xe(e))));const h=a?bt[a]:void 0;return r(s(s({placeholder:kt(G(p))},{}),te(i,"onChange")),{[h]:x,[f]:v})})),b=v((()=>{var t,n;const{editComponentProps:o,editValueMap:l}=e.column,i=G(u);if(l&&ne(l))return l(i);if(!G(p).includes("NSelect"))return i;const s=(null!=(t=null==o?void 0:o.options)?t:G(a)||[]).find((e=>`${e.value}`==`${i}`));return null!=(n=null==s?void 0:s.label)?n:i})),C=v((()=>({width:"calc(100% - 48px)"}))),k=v((()=>{const{align:t="center"}=e.column;return`edit-cell-align-${t}`})),y=v((()=>{const{editable:t}=e.record||{};return!!t}));function x(n){return c(this,arguments,(function*(n){var o,l,i;const a=G(p);n?(null==n?void 0:n.target)&&Reflect.has(n.target,"value")?u.value=n.target.value:"NCheckbox"===a?u.value=n.target.checked:(Z(n)||X(n)||Q(n))&&(u.value=n):u.value=n;const s=null==(l=null==(o=e.column)?void 0:o.editComponentProps)?void 0:l.onChange;s&&ne(s)&&s(...arguments),null==(i=t.emit)||i.call(t,"edit-change",{column:e.column,value:G(u),record:Y(e.record)}),yield S()}))}function S(){return c(this,null,(function*(){const{column:t,record:n}=e,{editRule:o}=t,a=G(u);if(o){if(X(o)&&!a&&!Q(a)){l.value=!0;const e=G(p);return i.value=kt(e),!1}if(ne(o)){const e=yield o(a,n);return e?(i.value=e,l.value=!0,!1):(i.value="",!0)}}return i.value="",!0}))}function P(o=!0,l=!0){return c(this,null,(function*(){var i;if(l){if(!(yield S()))return}const{column:a,index:s,record:r}=e;if(!r)return;const{key:c}=a,d=G(u);if(!c)return;le(r,c,d),o&&(null==(i=t.emit)||i.call(t,"edit-end",{record:r,index:s,key:c,value:d})),n.value=!1}))}function w(){var o;n.value=!1,u.value=d.value;const{column:a,index:s,record:r}=e,{key:c}=a;l.value=!0,i.value="",null==(o=t.emit)||o.call(t,"edit-cancel",{record:r,index:s,key:c,value:G(u)})}function E(t,n){var o;e.record&&(ee(e.record[t])?null==(o=e.record[t])||o.push(n):e.record[t]=[n])}return $((()=>{d.value=e.value})),$((()=>{const{editable:t}=e.column;(X(t)||X(G(y)))&&(n.value=!!t||G(y))})),e.record&&(E("submitCbs",P),E("validCbs",S),E("cancelCbs",w),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=u),e.record.onCancelEdit=()=>{var t,n;ee(null==(t=e.record)?void 0:t.cancelCbs)&&(null==(n=e.record)||n.cancelCbs.forEach((e=>e())))},e.record.onSubmitEdit=()=>c(this,null,(function*(){var n,o,l,i;if(ee(null==(n=e.record)?void 0:n.submitCbs)){const n=((null==(o=e.record)?void 0:o.validCbs)||[]).map((e=>e()));if(!(yield Promise.all(n)).every((e=>!!e)))return;return((null==(l=e.record)?void 0:l.submitCbs)||[]).forEach((e=>e(!1,!1))),null==(i=t.emit)||i.call(t,"edit-row-end"),!0}}))),{isEdit:n,handleEdit:function(){var t;G(y)||G(null==(t=e.column)?void 0:t.editRow)||(i.value="",n.value=!0,oe((()=>{var e;const t=G(o);null==(e=null==t?void 0:t.focus)||e.call(t)})))},currentValueRef:u,handleSubmit:P,handleChange:x,handleCancel:w,elRef:o,getComponent:p,getRule:f,onClickOutside:function(){var t;if((null==(t=e.column)?void 0:t.editable)||G(y))return;G(p).includes("NInput")&&w()},ruleMessage:i,getRuleVisible:g,getComponentProps:h,handleOptionsChange:function(e){a.value=e},getWrapperStyle:C,getWrapperClass:k,getRowEditable:y,getValues:b,handleEnter:function(){return c(this,null,(function*(){var t;(null==(t=e.column)?void 0:t.editRow)||(yield P())}))}}}}),xt={class:"editable-cell"},St={class:"flex editable-cell-content"},Pt={class:"editable-cell-content-comp"},wt={key:0,class:"editable-cell-action"};const Et=I(yt,[["render",function(e,t,n,o,l,i){const a=u,s=ze,r=A("CellComponent"),c=ie("click-outside");return U(),ae("div",xt,[se(q("div",{class:"editable-cell-content",onClick:t[0]||(t[0]=(...t)=>e.handleEdit&&e.handleEdit(...t))},[K(ce(e.getValues)+" ",1),e.column.editRow?ue("",!0):(U(),M(s,{key:0,class:"edit-icon"},{default:H((()=>[W(a,{icon:"ant-design:form-outlined"})])),_:1}))],512),[[re,!e.isEdit]]),se((U(),ae("div",St,[q("div",Pt,[W(r,de(e.getComponentProps,{ref:"elRef",component:e.getComponent,style:e.getWrapperStyle,"popover-visible":e.getRuleVisible,"rule-message":e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","style","popover-visible","rule-message","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?ue("",!0):(U(),ae("div",wt,[W(s,{class:"mx-2 cursor-pointer"},{default:H((()=>[W(a,{icon:"ant-design:check-outlined",onClick:e.handleSubmit},null,8,["onClick"])])),_:1}),W(s,{class:"mx-2 cursor-pointer"},{default:H((()=>[W(a,{icon:"ant-design:close-outlined",onClick:e.handleCancel},null,8,["onClick"])])),_:1})]))])),[[re,e.isEdit],[c,e.onClickOutside]])])}]]);function _t(e){const t=O(G(e).columns);let n=G(e).columns;const o=v((()=>{const n=B(G(t));return function(e,t){const{actionColumn:n}=G(e);if(!n)return;!t.find((e=>"action"===e.key))&&t.push(s({},n))}(e,n),n||[]})),{hasPermission:l}=pe();const i=v((()=>{const e=G(o);return B(e).filter((e=>l(e.auth)&&function(e){const{ifShow:t}=e;let n=!0;return X(t)&&(n=t),ne(t)&&(n=t(e)),n}(e))).map((e=>{e.ellipsis=void 0===e.ellipsis&&{tooltip:!0};const{edit:t}=e;if(t&&(e.render=function(e){return(t,n)=>{const o=e.key,l=t[o];return t.onEdit=(e,n=!1)=>c(this,null,(function*(){var o,l;return n||(t.editable=e),!e&&n?!!(yield null==(o=t.onSubmitEdit)?void 0:o.call(t))&&(t.editable=!1,!0):(e||n||null==(l=t.onCancelEdit)||l.call(t),!0)})),k(Et,{value:l,record:t,column:e,index:n})}}(e),t)){const t=e.title;e.title=()=>W(Ne,null,{trigger:()=>W("span",null,[W("span",{class:"mr-5px"},[t]),W(u,{class:"text-14px",icon:"ant-design:form-outlined"},null)]),default:()=>"该列可编辑"})}return e}))}));return J((()=>G(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:o,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key===e&&Object.assign(n,t)}))},setColumns:function(e){const o=B(e);if(!ee(o))return;if(!o.length)return void(t.value=[]);const l=n.map((e=>e.key));if(Z(o[0])){const i=[];n.forEach((t=>{e.includes(t.key)&&i.push(s({},t))})),He(l,o)||i.sort(((e,t)=>l.indexOf(e.key)-l.indexOf(t.key))),t.value=i}else t.value=o},getColumns:function(){return Y(G(o)).map((e=>r(s({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:i}}const{table:Rt}=qe,{apiSetting:Nt,defaultPageSize:zt,pageSizes:Ot}=Rt,Tt=zt,jt=Nt,Dt=Ot;const Lt=r(s({},Ke),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},actionColumn:{type:Object,default:null},showAdvanced:Me.bool.def(!0),canResize:Me.bool.def(!0),resizeHeightOffset:Me.number.def(0)});var It=(e=>(e[e.REFRESH=0]="REFRESH",e[e.SELECT=1]="SELECT",e[e.EDITOR=2]="EDITOR",e[e.DELETE=3]="DELETE",e))(It||{});const{t:Ft}=ge(),$t=[{key:It.REFRESH,label:Ft("component.table.refresh"),icon:()=>W(u,{icon:"ant-design:reload-outlined"},null)},{key:It.SELECT,label:Ft("component.table.select"),icon:()=>W(u,{icon:"ci:select-multiple"},null)},{key:It.EDITOR,label:Ft("component.table.editor"),icon:()=>W(u,{icon:"ant-design:edit-filled"},null)},{key:It.DELETE,label:Ft("component.table.delete"),icon:()=>W(u,{icon:"ant-design:delete-outlined"},null)}],Bt=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}],Vt=f({components:{ColumnSetting:ht},props:Lt,emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change","update:drop-editor","update:drop-delete"],setup(e,{emit:t}){const n=O(150),o=O(),l=O(null);let i;const a=O([]),u=O(),d=v((()=>s(s({},e),G(u)))),{getLoading:p,setLoading:f}=function(e){const t=O(G(e).loading);return J((()=>G(e).loading),(e=>{t.value=e})),{getLoading:v((()=>G(t))),setLoading:function(e){t.value=e}}}(d),{getPaginationInfo:g,setPagination:m}=function(e){const t=O({}),n=O(!0),o=v((()=>{const{pagination:o}=G(e);if(!G(n)||X(o)&&!o)return!1;const{totalField:l}=jt;return r(s(s({pageSize:Tt,pageSizes:Dt,showSizePicker:!0,showQuickJumper:!0},X(o)?{}:o),G(t)),{pageCount:G(t)[l]})}));return{getPagination:function(){return G(o)},getPaginationInfo:o,setShowPagination:function(e){return c(this,null,(function*(){n.value=e}))},getShowPagination:function(){return G(n)},setPagination:function(e){const n=G(o);t.value=s(s({},X(n)?{}:n),e)}}}(d),{getDataSourceRef:h,getRowKey:b,reload:C}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:l},i){const a=O([]);$((()=>{l.value=G(a)})),J((()=>G(e).dataSource),(()=>{const{dataSource:t}=G(e);t&&(a.value=t)}),{immediate:!0});const r=v((()=>{const{rowKey:t}=G(e);return t||(()=>"key")})),u=v((()=>{const e=G(a);return e&&e.length,G(a)}));function d(l){return c(this,null,(function*(){const{request:r,pagination:c,data:u}=G(e);if(r||!u)try{o(!0);const{pageField:e}=jt,{sizeField:u}=jt,{totalField:p}=jt,{listField:f}=jt;let g={};const{page:m=1,pageSize:v=10}=G(t);X(c)&&!c||X(t)?g={}:(g[e]=l&&l[e]||m,g[u]=v);const h=s({},g),b=yield r(h),C=b[p]||0,k=b[e];C&&m>C&&(n({[e]:C}),d(l));const y=b[f]?b[f]:[];a.value=y,n({[e]:k,[p]:C}),l&&l[e]&&n({[e]:l[e]||1}),i("fetch-success",{items:G(y),resultTotal:C})}catch(p){i("fetch-error",p),a.value=[]}finally{o(!1)}else a.value=u}))}return fe((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:r,getDataSourceRef:u,getDataSource:function(){return u.value},setTableData:function(e){a.value=e},reload:function(e){return c(this,null,(function*(){yield d(e)}))}}}(d,{getPaginationInfo:g,setPagination:m,tableData:a,setLoading:f},t),{getPageColumns:k,setColumns:y,getColumns:x,getCacheColumns:S,setCacheColumnsField:P}=_t(d),w=F({tableSize:G(d).size||"medium",isColumnSetting:!1});const E=v((()=>w.tableSize)),_=v((()=>{const e=G(h),t=e.length&&G(z)?`${G(n)}px`:"auto";return r(s({},G(d)),{loading:G(p),rowKey:G(b),data:e,size:G(E),remote:!0,"max-height":t})})),R=v((()=>Y(G(g))));const N={reload:C,setColumns:y,setLoading:f,setProps:function(e){u.value=s(s({},G(u)),e)},getColumns:x,getPageColumns:k,getCacheColumns:S,setCacheColumnsField:P,emit:t},z=v((()=>{const{canResize:e}=G(d);return e}));var j;Le((function(){return c(this,null,(function*(){const t=ye(o);if(!t||!G(z))return;const l=t.querySelector(".n-data-table-thead"),{bottomIncludeBody:a}=We(l);let s=2;if(!X(R))if(i=t.querySelector(".n-data-table__pagination"),i){const{offsetHeight:e}=i;s+=e||0}else s+=28;let r=a-(64+s+24+(e.resizeHeightOffset||0));const{maxHeight:c}=e;r=c&&c<r?c:r,n.value=r}))}),280,{immediate:!0}),j=r(s({},N),{wrapRef:l,getBindValues:_}),T(it,j);const D=O(!1),L=O(),I=O(0),B=O(0);return r(s({},V(w)),{tableElRef:o,getBindValues:_,densityOptions:Bt,reload:C,densitySelect:function(e){w.tableSize=e},updatePage:function(e){m({page:e}),C()},updatePageSize:function(e){m({page:1,pageSize:e}),C()},getPageColumns:k,pagination:R,tableAction:N,dropMenuList:$t,showDropdown:D,x:I,y:B,handleSelect:e=>{switch(D.value=!1,e){case It.REFRESH:return C();case It.SELECT:return n=G(L),void t("update:checked-row-keys",n);case It.EDITOR:return t("update:drop-editor",G(L));case It.DELETE:return t("update:drop-delete",G(L))}var n},onClickoutside:function(){D.value=!1},rowProps:e=>({onContextmenu:t=>{t.preventDefault(),oe().then((()=>{L.value=e,D.value=!0,I.value=t.clientX,B.value=t.clientY}))}})})}}),At=e=>(xe("data-v-3334626e"),e=e(),Se(),e),Ut={key:0,class:"table-toolbar"},Mt={class:"flex items-center table-toolbar-left"},Ht={key:0,class:"table-toolbar-left-title"},qt={class:"flex items-center table-toolbar-right"},Wt=At((()=>q("span",null,"刷新",-1))),Kt={class:"table-toolbar-right-icon"},Yt=At((()=>q("span",null,"密度",-1))),Gt={class:"s-table"};const Jt=I(Vt,[["render",function(e,t,n,o,l,i){const a=Ie,s=De,r=u,c=Ne,d=Ge,p=ht,f=Ye;return U(),ae(ke,null,[e.showAdvanced?(U(),ae("div",Ut,[q("div",Mt,[e.title?(U(),ae("div",Ht,[e.titleTooltip?(U(),M(a,{key:0,tipsMessage:e.titleTooltip,trigger:"hover"},{default:H((()=>[K(ce(e.title),1)])),_:1},8,["tipsMessage"])):ue("",!0)])):ue("",!0),me(e.$slots,"tableTitle",{},void 0,!0)]),q("div",qt,[me(e.$slots,"toolbar",{},void 0,!0),W(s,{class:"!ml-5",vertical:""}),W(c,{trigger:"hover"},{trigger:H((()=>[q("div",{class:"table-toolbar-right-icon",onClick:t[0]||(t[0]=(...t)=>e.reload&&e.reload(...t))},[W(r,{icon:"ant-design:reload-outlined",class:"text-18px"})])])),default:H((()=>[Wt])),_:1}),W(c,{trigger:"hover"},{trigger:H((()=>[q("div",Kt,[W(d,{value:e.tableSize,"onUpdate:value":t[1]||(t[1]=t=>e.tableSize=t),trigger:"click",options:e.densityOptions,onSelect:e.densitySelect},{default:H((()=>[W(r,{icon:"ant-design:column-height-outlined",class:"text-18px"})])),_:1},8,["value","options","onSelect"])])])),default:H((()=>[Yt])),_:1}),W(p)])])):ue("",!0),q("div",Gt,[W(f,de({ref:"tableElRef"},e.getBindValues,{columns:e.getPageColumns,pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize,"row-props":e.rowProps}),ve({_:2},[he(Object.keys(e.$slots),(t=>({name:t,fn:H((n=>[me(e.$slots,t,be(Ce(n)),void 0,!0)]))})))]),1040,["columns","pagination","onUpdate:page","onUpdate:pageSize","row-props"]),W(d,{placement:"bottom-start",trigger:"manual",x:e.x,y:e.y,options:e.dropMenuList,show:e.showDropdown,onSelect:e.handleSelect,"on-clickoutside":e.onClickoutside},null,8,["x","y","options","show","onSelect","on-clickoutside"])])],64)}],["__scopeId","data-v-3334626e"]]),Qt=f({__name:"popConfirmWrapper",props:{isWrapper:Boolean},setup(e){const t=Pe(),n=v((()=>te(s({showIcon:!0},t),["title","icon"])));return(o,l)=>{const i=u,a=lt;return e.isWrapper?(U(),M(a,be(de({key:0},n.value)),ve({trigger:H((()=>[me(o.$slots,"default")])),default:H((()=>[K(" "+ce(G(t).title),1)])),_:2},[G(t).icon?{name:"icon",fn:H((()=>[W(i,{icon:G(t).icon},null,8,["icon"])])),key:"0"}:void 0]),1040)):me(o.$slots,"default",{key:1})}}}),Xt={class:"tableAction"},Zt={class:"flex items-center justify-center py-1 px-2 space-x-2"},en=f(r(s({},{name:"TableAction"}),{props:{actions:{},dropDownActions:{},style:{default:"button"},select:{}},setup(e){const t=e,{hasPermission:n}=pe(),a="button"===t.style?"default":"text"===t.style?"primary":"default",c="button"===t.style?void 0:"text"===t.style||void 0,d=v((()=>({text:c,type:a,size:"small"}))),p=v((()=>(Y(t.dropDownActions)||[]).filter((e=>n(e.auth)&&g(e))))),f=v((()=>(Y(t.actions)||[]).filter((e=>n(e.auth)&&g(e))).map((e=>{const{popConfirm:t}=e;return r(s(s({size:"small",text:c,type:a},e),t||{}),{enable:!!t})}))));function g(e){const t=e.ifShow;let n=!0;return X(t)&&(n=t),ne(t)&&(n=t(e)),n}return(e,t)=>{const n=u,a=y,s=Ge;return U(),ae("div",Xt,[q("div",Zt,[(U(!0),ae(ke,null,he(f.value,((e,t)=>{var s=e,{icon:r,label:c,enable:u,popConfirm:d}=s,p=((e,t)=>{var n={};for(var a in e)l.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&i.call(e,a)&&(n[a]=e[a]);return n})(s,["icon","label","enable","popConfirm"]);return U(),M(Qt,de({key:`${t}-${c}`,"is-wrapper":u,ref_for:!0},d),{default:H((()=>[W(a,de({ref_for:!0},p),ve({default:H((()=>[K(ce(c),1)])),_:2},[r?{name:"icon",fn:H((()=>[W(n,{icon:r},null,8,["icon"])])),key:"0"}:void 0]),1040)])),_:2},1040,["is-wrapper"])})),128)),e.dropDownActions&&p.value.length?(U(),M(s,{key:0,trigger:"hover",options:p.value,onSelect:e.select},{default:H((()=>[me(e.$slots,"more",{},(()=>[W(n,de({icon:"akar-icons:more-horizontal",class:"!ml-4"},d.value),null,16)]))])),_:3},8,["options","onSelect"])):ue("",!0)])])}}}));export{Jt as B,en as _};
